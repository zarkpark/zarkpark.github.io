<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KOMOJU ê²°ì œ</title>
    <script type="module" src="https://multipay.komoju.com/fields.js"></script>
    <style>
        :root,:host {
            --primary-color: #000000;
            --error-color: #df1b41;
            --secondary-color: #6d6e78;
            --placeholder-color: #6d6e78;
            --border-color: #e6e6e6;
            --selected-color: #0570de;
            --field-background: #ffffff;
            --hover-background: #cccccc1f;
        }

        .payment-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            color: var(--primary-color);
            margin-bottom: 30px;
            text-align: center;
        }

        .theme-controls {
            margin-bottom: 30px;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 8px;
        }

        .color-control {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .color-control label {
            width: 200px;
            margin-right: 10px;
        }

        .color-control input[type="color"] {
            width: 50px;
            height: 30px;
            margin-right: 10px;
        }

        .color-control span {
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="payment-container">
        <h1>ê²°ì œ í˜ì´ì§€</h1>
        
        <div id="session-input-container">
            <div style="margin-bottom: 20px;">
                <label for="session-input">ì„¸ì…˜ ID:</label>
                <input type="text" id="session-input" placeholder="ì„¸ì…˜ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                <button id="start-payment">ê²°ì œ ì‹œì‘</button>
            </div>

            <div style="background: #f5f5f5; padding: 15px; border-radius: 5px;">
                <p style="margin-bottom: 10px;">ì•„ë˜ ëª…ë ¹ì–´ë¥¼ í„°ë¯¸ë„ì— ì‹¤í–‰í•œ í›„, id ê°’ì„ ì…ë ¥í•˜ì„¸ìš”</p>
                <pre style="background: #2d2d2d; color: #ffffff; padding: 15px; border-radius: 5px; overflow-x: auto;"><code>curl -X POST https://komoju.com/api/v1/sessions \
  --user 'ë¹„ë°€í‚¤(ìí¬í•œí…Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”):' \
  --data mode=customer \
  --data amount=1000 \
  --data currency=JPY \
  --data return_url=https://example.com</code></pre>
            </div>
        </div>

        <div id="payment-section" style="display: none;">
            <div class="theme-controls">
                <h3>í…Œë§ˆ ìƒ‰ìƒ ì„¤ì •</h3>
                <div class="color-control">
                    <label>ê¸°ë³¸ ìƒ‰ìƒ:</label>
                    <input type="color" id="primary-color" value="#000000">
                    <span>#000000</span>
                </div>
                <div class="color-control">
                    <label>ì—ëŸ¬ ìƒ‰ìƒ:</label>
                    <input type="color" id="error-color" value="#df1b41">
                    <span>#df1b41</span>
                </div>
                <div class="color-control">
                    <label>ë³´ì¡° ìƒ‰ìƒ:</label>
                    <input type="color" id="secondary-color" value="#6d6e78">
                    <span>#6d6e78</span>
                </div>
                <div class="color-control">
                    <label>í”Œë ˆì´ìŠ¤í™€ë” ìƒ‰ìƒ:</label>
                    <input type="color" id="placeholder-color" value="#6d6e78">
                    <span>#6d6e78</span>
                </div>
                <div class="color-control">
                    <label>í…Œë‘ë¦¬ ìƒ‰ìƒ:</label>
                    <input type="color" id="border-color" value="#e6e6e6">
                    <span>#e6e6e6</span>
                </div>
                <div class="color-control">
                    <label>ì„ íƒ ìƒ‰ìƒ:</label>
                    <input type="color" id="selected-color" value="#0570de">
                    <span>#0570de</span>
                </div>
                <div class="color-control">
                    <label>í•„ë“œ ë°°ê²½ìƒ‰:</label>
                    <input type="color" id="field-background" value="#ffffff">
                    <span>#ffffff</span>
                </div>
            </div>

            <div style="background: #f5f5f5; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                <p style="margin-bottom: 10px;">í…ŒìŠ¤íŠ¸ ê²°ì œë¥¼ ìœ„í•´ ë‹¤ìŒ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”:</p>
                <ul style="list-style: none; padding-left: 0;">
                    <li>ğŸ‘¤ ì´ë¦„: ì•„ë¬´ ì´ë¦„ì´ë‚˜ ë„£ìœ¼ì„¸ìš” (ì˜ˆ: hj)</li>
                    <li>ğŸ’³ ì¹´ë“œë²ˆí˜¸: 4100000000000100</li>
                    <li>ğŸ“… ìœ íš¨ê¸°ê°„: 08/25</li>
                    <li>ğŸ”’ CVC: 123</li>
                </ul>
            </div>

            <div id="payment-form">
                <komoju-fields
                    id="komoju-fields"
                    token
                    session-id=""
                    publishable-key="pk_test_c2w0tmxuswzsl030rzvhs0iu"
                ></komoju-fields>
                
                <button type="button" id="submit-button" onclick="submitPayment()" style="margin-top: 20px;">ê²°ì œí•˜ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        const sessionInput = document.getElementById('session-input');
        const startPaymentBtn = document.getElementById('start-payment');
        const paymentSection = document.getElementById('payment-section');
        const komojuFields = document.getElementById('komoju-fields');
        
        startPaymentBtn.addEventListener('click', () => {
            const sessionId = sessionInput.value.trim();
            
            if (!sessionId) {
                alert('ì„¸ì…˜ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ì„¸ì…˜ ID ì„¤ì •
            komojuFields.setAttribute('session-id', sessionId);
            
            // ê²°ì œ ì„¹ì…˜ í‘œì‹œ
            paymentSection.style.display = 'block';
            document.getElementById('session-input-container').style.display = 'none';

            // ì´ˆê¸° í…Œë§ˆ ì„¤ì •
            updateTheme();
        });

        // validityChange ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        komojuFields.addEventListener('validityChange', (event) => {
            document.getElementById('submit-button').disabled = !event.detail.valid;
        });

        async function submitPayment() {
            try {
                // KOMOJU Fieldsì—ì„œ í† í° ìƒì„±
                const result = await komojuFields.submit();
                
                // ë°±ì—”ë“œë¡œ í† í° ì „ì†¡
                await sendTokenToBackend(result.token);
                
            } catch (error) {
                console.error('ê²°ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:', error);
                alert('ê²°ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        async function sendTokenToBackend(token) {
            // const response = await fetch('/your-backend-endpoint', {
            //     method: 'POST',
            //     headers: {
            //         'Content-Type': 'application/json',
            //     },
            //     body: JSON.stringify({ token })
            // });

            // if (!response.ok) {
            //     throw new Error('ê²°ì œ ì²˜ë¦¬ ì‹¤íŒ¨');
            // }
            console.log(token);

            // ì„±ê³µ ì‹œ ì²˜ë¦¬ (ì˜ˆ: ì„±ê³µ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸)
            window.location.href = '/success';
        }

        function updateTheme() {
            const colors = {
                'primary-color': '',
                'error-color': '',
                'secondary-color': '',
                'placeholder-color': '',
                'border-color': '',
                'selected-color': '',
                'field-background': '',
                'hover-background': '#cccccc1f'
            };

            Object.keys(colors).forEach(key => {
                if (key !== 'hover-background') {
                    const input = document.getElementById(key);
                    colors[key] = input.value;
                    input.nextElementSibling.textContent = input.value;
                }
            });

            const themeCSS = `:root,:host{
                --primary-color:${colors['primary-color']};
                --error-color:${colors['error-color']};
                --secondary-color:${colors['secondary-color']};
                --placeholder-color:${colors['placeholder-color']};
                --border-color:${colors['border-color']};
                --selected-color:${colors['selected-color']};
                --field-background:${colors['field-background']};
                --hover-background:${colors['hover-background']};
            }`;

            komojuFields.setAttribute('theme', `data:text/css,${encodeURIComponent(themeCSS)}`);
        }

        document.querySelectorAll('input[type="color"]').forEach(input => {
            input.addEventListener('change', updateTheme);
        });
    </script>
</body>
</html> 
